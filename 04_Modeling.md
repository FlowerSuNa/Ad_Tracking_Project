##### TalkingData AdTracking Fraud Detection Challenge
# 4. Modeling
[source code](04_Modeling.py) <br>
[Excel](performance.xlsx) <br>
[various attempts](trial/README.md) <br>

Find the important features and then, make the model using Logistic Regression, Decision Tree, Random Forest, Gradient boosting and LightGBM.

<br>

---

## Split Train Data

#### Train Size : 10,000,000

| Train Size | Dataset | Not Downloaded | Downloaded | Total |
|:----------:|:-------:|---------------:|-----------:|------:|
| 10,000,000 | Train | 7,982,502 | 17,498 | 8,000,000 |
| | Valid | 1,995,618 | 4,382 | 2,000,000 |
| 20,000,000 | Train | 15,962,214 | 37,786 | 16,000,000 |
| | Valid | 3,990,607 | 9,393 | 4,000,000 |
| 30,000,000 | Train | 23,939,416 | 60,584 | 24,000,000 |
| | Valid | 5,984,690 | 15,310 | 6,000,000 |
| 40,000,000 | Train | 31,919,562 | 80,438 | 32,000,000 |
| | Valid | 7,979,930 | 20,070 | 8,000,000 |
| 50,000,00 | Train | 39,897,655 | 102,345 | 40,000,000 |
| | Valid | 9,974,300 | 25,700 | 10,000,000 |
| All | Train | 147,557,584 | 365,528 | 147,923,112 |
| | Valid | 36,889,460 | 91,318 | 36,980,778 |

> Use 20,000,000 data set a lot, because it is similar to the number of test data set.

<br>

---

## Used features : rate_ip, rate_app, rate_os, rate_device, rate_channel, rate_hour

Hypothesis : The download rate per feature determine whether to download.

<br>

#### Logistic Regression

* Train Size : 20,000,000

* Score and Coefficient

| C | Train AUC | Valid AUC | Score | | rate_ip | rate_app | rate_os | rate_device | rate_channel | rate_hour |
|:-:|:---------:|:---------:|:-----:|-|:-------:|:--------:|:-------:|:-----------:|:------------:|:---------:|
| 0.01 | 0.96261 | 0.96278 | 0.9367697 || 8.83573 | 8.30467 | 6.26596 | 5.96615 | 8.95498 | -0.00403 |
| 0.1 | 0.96191 | 0.96208 | - || 9.98409 | 8.98668 | 10.85662 | 7.91580 | 10.10841 | 0.05951 |
| 1 | 0.96156 | 0.96178 | - || 10.15168 | 9.04859 | 13.02725 | 7.12579 | 10.15123 | 0.17767 |
| 10 | 0.96151 | 0.96174 | - || 10.16968 | 9.05410 | 13.38279 | 6.93660 | 10.15283 | 0.20691 |
| 100 | 0.96150 | 0.96173 | - || 10.17151 | 9.05464 | 13.42077 | 6.91559 | 10.15299 | 0.21035 |

<br>

#### Decision Tree

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_ip | rate_app | rate_os | rate_device | rate_channel | rate_hour |
|:---------:|:---------:|:---------:|:-----:|-|:-------:|:--------:|:-------:|:-----------:|:------------:|:---------:|
| 3 | 0.88169 | 0.88168 | 0.7888061 | Overfitting | **0.76824** | 0.23098 | 0 | 0 | 0.00078 | 0 |
| 4 | 0.90263 | 0.90310 | 0.8180792 || **0.64219** | 0.28548 | 0 | 0.03179 | 0.04054 | 0 |
| 5 | 0.90376 | 0.90446 | 0.8231087 || **0.62294** | 0.27737 | 0.02594 | 0.02986 | 0.04208 | 0.00180 |
| 6 | 0.93409 | 0.93380 | 0.8826352 || **0.62014** | 0.27690 | 0.02580 | 0.02943 | 0.04564 | 0.00208 |
| 7 | 0.93491 | 0.93425 | 0.8832672 || **0.62073** | 0.26729 | 0.02743 | 0.02946 | 0.05227 | 0.00282 |

<br>

## Used features : rate_app, rate_os, rate_device, rate_channel, rate_hour

Overfitting occurred, remove feature 'rate_ip' and make models.

<br>

#### Logistic Regression

* Train Size : 20,000,000

* Score and Coefficient

| C | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_device | rate_channel | rate_hour |
|:-:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:-----------:|:------------:|:---------:|
| 0.01 | 0.95613 | 0.95553 | 0.9472774 || 9.07053 | 7.80990 | 7.42953 | 0.10734 | -0.00269 |
| 0.1 | 0.95529 | 0.95471 | - || 9.72578 | 12.53654 | 8.94837 | 12.08472 | 0.04231 |
| 1 | 0.95504 | 0.95448 | - || 9.76096 | 14.40439 | 8.25626 | 12.17003 | 0.99752 |
| 10 | 0.95467 | 0.95404 | - || 9.76358 | 14.68323 | 8.11816 | 12.17405 | 8.16964 |
| 100 | 0.95466 | 0.95403 | - || 9.76751 | 14.67653 | 8.12769 | 12.17345 | 8.24220 |

<br>

#### Decision Tree

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_device | rate_channel | rate_hour |
|:---------:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:-----------:|:------------:|:---------:|
| 3 | 0.92675 | 0.92646 | - || 0.70852 | 0.00429 | 0 | 0.28719 | 0 |    
| 4 | 0.92967 | 0.92910 | - || 0.52808 | 0.20342 | 0.00282 | 0.26568 | 0 |
| 5 | 0.95296 | 0.95193 | 0.9363925 || 0.47189 | 0.18632 | 0.00249 | 0.33659 | 0.00270 |
| 6 | 0.96002 | 0.95906 | 0.9439176 || 0.46533 | 0.19361 | 0.00983 | 0.32733 | 0.00389 |
| 7 | **0.96137** | **0.96012** | **0.9413582** || 0.46043 | 0.19400 | 0.01416 | 0.32401 | 0.00740 |

<br>

## Used features : rate_app, rate_os, rate_channel

Make models with three features that are high feature importance.

<br>

#### Logistic Regression

* Train Size : 20,000,000

* Score and Coefficient

| C | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_channel |
|:-:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:------------:|
| 0.01 | 0.95494 | 0.95444 | 0.9457139 || 9.40680 | 9.84060 | 11.46867 |
| 0.1 | 0.95347 | 0.95302 | - || 9.84446 | 19.20921 | 12.79420 |
| 1 | 0.95316 | 0.95272 | - || 9.80845 | 21.30565 | 12.63379 |
| 10 | 0.95314 | 0.95270 | - || 9.80282 | 21.52774 | 12.62223 |
| 100 | 0.95313 | 0.95269 | - || 9.80231 | 21.55137 | 12.62000 |

<br>

#### Decision Tree

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_channel |
|:---------:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:------------:|
| 3 | 0.92675 | 0.92646 | - || 0.70852 | 0.00429 | 0.28719 |
| 4 | 0.92967 | 0.92910 | - || 0.52582 | 0.20420 | 0.26997 |
| 5 | 0.95296 | 0.95193 | 0.9363924 || 0.47736 | 0.18762 | 0.33502 |
| 6 | 0.96038 | 0.95949 | 0.9450054 || 0.46861 | 0.20187 | 0.32953 |
| 7 | 0.96268 | 0.96164 | 0.9473591 || 0.46297 | 0.20511 | 0.33191 |

<br>

#### Random Forest

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | n_estimators | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_channel |
|:---------:|:------------:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:------------:|
| 3 | 50 | 0.93918 | 0.93977 | - || 0.46121 | 0.21606 | 0.32273 |
| | 70 | 0.93810 | 0.93852 | - || 0.41601 | 0.22909 | 0.35490 |
| | 100 | 0.93887 | 0.93940 | - || 0.43509 | 0.19891 | 0.36600 |
| 4 | 50 | 0.95010 | 0.94954 | - || 0.43839 | 0.15295 | 0.40866 |
| | 70 | 0.94952 | 0.94916 | - || 0.40120 | 0.19832 | 0.40048 |
| | 100 | 0.94646 | 0.94554 | - || 0.40977 | 0.20700 | 0.38323 |
| 5 | 50 | 0.95640 | 0.95518 | - || 0.38725 | 0.22160 | 0.39115 |
| | 70 | 0.95295 | 0.955237 | - || 0.38245 | 0.19119 | 0.42636 |
| | 100 | 0.95359 | 0.95274 | - || 0.37707 | 0.19082 | 0.43211 |
| 6 | 50 | 0.95993 | 0.95907 | 0.9496954 || 0.36191 | 0.21108 | 0.42701 |
| | 70 | 0.96046 | 0.95954 | 0.9509133 || 0.39358 | 0.21123 | 0.39519 |
| | 100 | 0.96071 | 0.95986 | 0.9506994 || 0.40916 | 0.21873 | 0.37210 |
| 7 | 50 | **0.96214** | **0.96117** | **0.9527221** | Good | 0.40925 | 0.22861 | 0.36214 |
| | 70 | 0.96318 | 0.96224 | 0.9524520 || 0.41910 | 0.22377 | 0.35713 |
| | 100 | 0.96170 | 0.96077 | 0.9520009 || 0.37782 | 0.24351 | 0.37867 |

<br>

#### Gradient Boosting

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | n_estimators | learning_rate | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_channel |
|:---------:|:------------:|:-------------:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:------------:|
| 5 |	0.001 |	50 | 0.95296 | 0.95194 | - || 0.47659 | 0.18763 | 0.33578 |
| |	|	70 | 0.95296 | 0.95194 | - || 0.47656 | 0.18773 | 0.33571 |
| |	0.01 | 50 |	0.95831 |	0.95747 | - ||	0.49885 |	0.17606 | 0.32509 |
| | |	70 | 0.96161 | 0.96064 | - || 0.50193 | 0.18041 | 0.31766 |
|	| 0.1 |	50 | 0.82916 | 0.83251 | - || 0.46772 | 0.16163 | 0.37065 |
| | |	70 | 0.82892 | 0.83243 | - || 0.49709 | 0.15610 | 0.34681 |
| 6 |	0.001 |	50 | 0.96040 | 0.95950 | - || 0.46842 | 0.19944 |	0.33213 |
| | |	70 | 0.96040 | 0.95950 | - || 0.46889 |	0.19853 |	0.33258 |
| |	0.01 | 50 |	0.96316 |	0.96220 | - || 0.49505 | 0.18339 | 0.32156 |
| | |	70 | 0.96451 | 0.96368 | - || 0.49560 | 0.18226 |	0.32214 |
| |	0.1 |	50 | 0.85581 | 0.85621 | - || 0.49240 |	0.23277 |	0.27482 |
| | |	70 | 0.85948 | 0.85974 | - || 0.53757 |	0.23008 |	0.23235 |
| 7 |	0.001 | 50 | 0.96287 | 0.96184 | - || 0.46514 |	0.20499 |	0.32987 |
| | |	70 | 0.96288 | 0.96186 | 0.9475317 || 0.46514 |	0.20493 |	0.32992 |
| | 0.01 | 50 | 0.96554 | 0.96470 |	0.9531514 || 0.49099 | 0.19117 | 0.31784 |
| | |	70 | 0.96579 | 0.96496 | 0.9534052 || 0.48823 |	0.19116 |	0.32061 |
| |	0.1 | 50 | 0.78256 | 0.78666 | - || 0.30885 |	0.37467 | 0.31648 |
| | |	70 | 0.78295 | 0.78684 | - || 0.28549 |	0.36273 |	0.35178 |

<br>

#### LightGBM

* Train Size : 20,000,000

* learning_rate : 0.05

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_app | rate_os | rate_channel |
|:----------:|:---------:|:---------:|:-----:|-|:--------:|:-------:|:------------:|
| 3 | 0.97067 |	0.96873 |	0.9558261 || 0.68675 | 0.02648 | 0.28678 |
| 4 | 0.97144 |	0.96904 |	0.9531237 || 0.68271 | 0.02907 | 0.28822 |
| 5 | 0.97193 |	0.96919 |	0.9527238 || 0.68137 | 0.03017 | 0.28846 |
| 6 | 0.97216 |	0.96929 |	**0.9532106** || 0.68041 | 0.03054 | 0.28905 |
| 7 | 0.97244 |	0.96933 |	0.9539550 || 0.68001 | 0.03102 | 0.28896 |

<br>

---

## Used Features : rate_app, rate_channel, rate_hour, gap_app, gap_device, gap_os, gap_channel, black_ip, click_gap

Hypothesis : Determine whether to download

1. Depending on the Download rate per app and channel

2. Based on whether or not the black list user

<br>

#### Decision Three

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_app | rate_channel | rate_hour | gap_app | gap_device | gap_os | gap_channel | black_ip | click_gap |
|:---------:|:---------:|:---------:|:-----:|-|:--------:|:------------:|:---------:|:-------:|:----------:|:------:|:-----------:|:--------:|:---------:|
| 3 | 0.92559 | 0.92568 | - || 0.48808 | 0.04248 | 0.00000 | 0.00000 | 0.05021 | 0.00000 | 0.00000 | 0.34057 | 0.07866 |
| 4 | 0.92985 |	0.92936 | - || 0.37487 | 0.03824 | 0.00235 | 0.00000 | 0.03856 | 0.00000 | 0.00599 | 0.45561 | 0.08437 |
| 5 | 0.93457 |	0.93502 | - || 0.36517 | 0.04593 | 0.00258 | 0.00318 | 0.03591 | 0.00014 | 0.03318 | 0.42953 | 0.08438 |
| 6 | 0.93616 |	0.93630 |	0.9156742 | 0.34745 |	0.05219 |	0.00245 |	0.00759 |	0.03408 |	0.00573 |	0.04401 |	0.40757 |	0.09894 |
| 7 | 0.95767 |	0.95696 |	0.9457318 | 0.34091 |	0.06073 |	0.00247 | 0.00751 |	0.03310 |	0.01350 |	0.04420 |	0.39372 |	0.10385 |

<br>

#### Random Forest

* Train Size : 20,000,000

* Score and Feature Importance

| max_depth | n_estimators | Train AUC | Valid AUC | Score | | rate_app | rate_channel | rate_hour | gap_app | gap_device | gap_os | gap_channel | black_ip | click_gap |
|:---------:|:------------:|:---------:|:---------:|:-----:|-|:--------:|:------------:|:---------:|:-------:|:----------:|:------:|:-----------:|:--------:|:---------:|
| 3 |	50 | 0.95239 | 0.95239 | 0.9453763 ||	0.31235 |	0.14200 |	0.00000 |	0.07417 |	0.01990 |	0.01256 | 0.01048 |	0.30343 |	0.12511 |
| | 70 | 0.95584 | 0.95576 | 0.9489753 ||	0.28851 |	0.21626 |	0.00000 |	0.08781 |	0.01470 |	0.00583 | 0.02216 |	0.22109 | 0.14365 |
| |	100	|	0.94808 |	0.94879 |	0.9377639 || 0.27325 | 0.21940 | 0.00000 | 0.07980 | 0.01059 | 0.00656 | 0.02750 | 0.25440 | 0.12850 |
| 4 | 50 | 0.96228 | 0.96161 | 0.9539604 ||	0.26022 |	0.19254 | 0.00018 | 0.08462 | 0.01153 | 0.01133 |	0.03956 |	0.30999 | 0.09004 |
| |	70 | 0.96399 | 0.96342 | 0.9560923 ||	0.27653 |	0.20889 | 0.00018 |	0.09650 |	0.01710 |	0.01333 |	0.02080 |	0.25385 |	0.11284 |
| |	100 |	0.95823 |	0.95794 |	0.9515724 || 0.26454 | 0.19593 | 0.00015 | 0.10022 | 0.01448 | 0.01404 | 0.02500 | 0.24249 | 0.14315 |
| 5 |	50 | 0.96414 | 0.96375 | 0.9564308 || 0.30821 | 0.15738 |	0.00089 |	0.10942 |	0.01509 |	0.01138 |	0.02341 |	0.24898 |	0.12523 |
| | 70 | 0.96387 | 0.96312 | 0.9568114 || 0.27827 | 0.16889 | 0.00051 | 0.08398 | 0.03010 | 0.02081 | 0.02465 | 0.26869 | 0.12410 |
| |	100	|	0.96267 |	0.96209 |	0.9558156 || 0.27812 | 0.19657 | 0.00072 | 0.07735 | 0.01779 | 0.01422 | 0.02998 | 0.27596 | 0.10929 |
| 6 | 50 | 0.96271 | 0.96232 | 0.9565972 ||	0.25879 |	0.18457 |	0.00149 |	0.08571 |	0.01871 |	0.01485 | 0.02825 |	0.25214 |	0.15547 |
| |	70 | 0.96470 | 0.96413 | 0.9575217 ||	0.25719 |	0.20049 | 0.00165 |	0.07585 | 0.01534 |	0.02562 |	0.03572 | 0.25565 |	0.13249 |
| |	100 | 0.96492 |	0.96420 | 0.9577560 || 0.27208 | 0.17526 | 0.00149 | 0.09777 | 0.01918 | 0.01906 | 0.03718 | 0.26217 | 0.11581 |
| 7 |	50 | 0.96736 | 0.96644 | **0.9601022** | Good | 0.30306 | 0.15949 | 0.00284 |	0.06556 |	0.02067 |	0.02621 |	0.03735 |	0.25623 | 0.12859 |
| |	70 | 0.96607 | 0.96538 | 0.9587274 || 0.25783 |	0.17945 |	0.00217 | 0.10187 | 0.01319 |	0.02684 |	0.04168 |	0.25637 |	0.12060 |
| |	100	|	0.96656 |	0.96578 |	0.9591477 || 0.26737 | 0.17157 | 0.00252 | 0.09251 | 0.01523 | 0.02455 | 0.03581 | 0.26013 | 0.13030 |

<br>

#### LightGBM

* Train Size : 20,000,000

* learning_rate : 0.05

* Score and Feature Importance

| max_depth | Train AUC | Valid AUC | Score | | rate_app | rate_channel | rate_hour | gap_app | gap_device | gap_os | gap_channel | black_ip | click_gap |
|:----------:|:---------:|:---------:|:-----:|-|:--------:|:------------:|:---------:|:-------:|:----------:|:------:|:-----------:|:--------:|:---------:|
| 3 | 0.97680 |	0.97429 |	0.9653391 || 0.85152 | 0.04484 | 0.00361 | 0.03607 | 0.00368 | 0.01493 | 0.00615 | 0.02989 | 0.00931 |
| 4 | 0.97777 |	0.97446 |	0.9654897 || 0.84830 | 0.04209 | 0.00422 | 0.03894 | 0.00407 | 0.01649 | 0.00613 | 0.02937 | 0.01039 |
| 5 | 0.97906 |	0.97445 |	0.9651422 || 0.84241 | 0.03975 | 0.00503 | 0.04042 | 0.00413 | 0.01796 | 0.00808 | 0.02937 | 0.01286 |
| 6 | 0.97959 | 0.97444 |	**0.9655556** | Good | 0.84182 | 0.03688 | 0.00532 | 0.04143 | 0.00422 | 0.01896 | 0.00853 | 0.02910 | 0.01376 |
| 7 | 0.98038 | 0.97445 | 0.9652391 || 0.83874 | 0.03681 | 0.00607 | 0.04130 | 0.00410 | 0.02054 | 0.00918 | 0.02859 | 0.01467 |



---

[Contents](README.md) <br>
[3. Sampling](03_Sampling.md) <br>
[5. Conclusion](05_Conclusion.md)
